<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../assets/css/yui-cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon.ico">
    <script src="../assets/js/yui-source.js"></script>
	<title>platypus v0.11.9 API Documentation : src\components\StateRender.js</title>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><a href="https://github.com/PBS-KIDS/Platypus"><img src="..\assets\platypus-title.png" title="platypus"></a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Documentation for: 0.11.9</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/platypus.AABB.html">platypus.AABB</a></li>
                                <li><a href="../classes/platypus.ActionState.html">platypus.ActionState</a></li>
                                <li><a href="../classes/platypus.Async.html">platypus.Async</a></li>
                                <li><a href="../classes/platypus.CollisionData.html">platypus.CollisionData</a></li>
                                <li><a href="../classes/platypus.CollisionDataContainer.html">platypus.CollisionDataContainer</a></li>
                                <li><a href="../classes/platypus.CollisionShape.html">platypus.CollisionShape</a></li>
                                <li><a href="../classes/platypus.Component.html">platypus.Component</a></li>
                                <li><a href="../classes/platypus.components.AIChaser.html">platypus.components.AIChaser</a></li>
                                <li><a href="../classes/platypus.components.AIPacer.html">platypus.components.AIPacer</a></li>
                                <li><a href="../classes/platypus.components.AudioSFX.html">platypus.components.AudioSFX</a></li>
                                <li><a href="../classes/platypus.components.AudioVO.html">platypus.components.AudioVO</a></li>
                                <li><a href="../classes/platypus.components.Camera.html">platypus.components.Camera</a></li>
                                <li><a href="../classes/platypus.components.CameraFollowMe.html">platypus.components.CameraFollowMe</a></li>
                                <li><a href="../classes/platypus.components.CollisionBasic.html">platypus.components.CollisionBasic</a></li>
                                <li><a href="../classes/platypus.components.CollisionFilter.html">platypus.components.CollisionFilter</a></li>
                                <li><a href="../classes/platypus.components.CollisionGroup.html">platypus.components.CollisionGroup</a></li>
                                <li><a href="../classes/platypus.components.CollisionTiles.html">platypus.components.CollisionTiles</a></li>
                                <li><a href="../classes/platypus.components.ComponentSwitcher.html">platypus.components.ComponentSwitcher</a></li>
                                <li><a href="../classes/platypus.components.Counter.html">platypus.components.Counter</a></li>
                                <li><a href="../classes/platypus.components.EntityContainer.html">platypus.components.EntityContainer</a></li>
                                <li><a href="../classes/platypus.components.EntityController.html">platypus.components.EntityController</a></li>
                                <li><a href="../classes/platypus.components.EventRender.html">platypus.components.EventRender</a></li>
                                <li><a href="../classes/platypus.components.HandlerCollision.html">platypus.components.HandlerCollision</a></li>
                                <li><a href="../classes/platypus.components.HandlerController.html">platypus.components.HandlerController</a></li>
                                <li><a href="../classes/platypus.components.HandlerLogic.html">platypus.components.HandlerLogic</a></li>
                                <li><a href="../classes/platypus.components.HandlerRender.html">platypus.components.HandlerRender</a></li>
                                <li><a href="../classes/platypus.components.Interactive.html">platypus.components.Interactive</a></li>
                                <li><a href="../classes/platypus.components.LevelBuilder.html">platypus.components.LevelBuilder</a></li>
                                <li><a href="../classes/platypus.components.LogicAngularMovement.html">platypus.components.LogicAngularMovement</a></li>
                                <li><a href="../classes/platypus.components.LogicAttachment.html">platypus.components.LogicAttachment</a></li>
                                <li><a href="../classes/platypus.components.LogicButton.html">platypus.components.LogicButton</a></li>
                                <li><a href="../classes/platypus.components.LogicCarrier.html">platypus.components.LogicCarrier</a></li>
                                <li><a href="../classes/platypus.components.LogicDestroyMe.html">platypus.components.LogicDestroyMe</a></li>
                                <li><a href="../classes/platypus.components.LogicDirectionalMovement.html">platypus.components.LogicDirectionalMovement</a></li>
                                <li><a href="../classes/platypus.components.LogicPortable.html">platypus.components.LogicPortable</a></li>
                                <li><a href="../classes/platypus.components.LogicRotationalMovement.html">platypus.components.LogicRotationalMovement</a></li>
                                <li><a href="../classes/platypus.components.LogicWindUpRacer.html">platypus.components.LogicWindUpRacer</a></li>
                                <li><a href="../classes/platypus.components.Motion.html">platypus.components.Motion</a></li>
                                <li><a href="../classes/platypus.components.Mover.html">platypus.components.Mover</a></li>
                                <li><a href="../classes/platypus.components.NodeMap.html">platypus.components.NodeMap</a></li>
                                <li><a href="../classes/platypus.components.NodeResident.html">platypus.components.NodeResident</a></li>
                                <li><a href="../classes/platypus.components.Orientation.html">platypus.components.Orientation</a></li>
                                <li><a href="../classes/platypus.components.RandomEvents.html">platypus.components.RandomEvents</a></li>
                                <li><a href="../classes/platypus.components.RelayFamily.html">platypus.components.RelayFamily</a></li>
                                <li><a href="../classes/platypus.components.RelayGame.html">platypus.components.RelayGame</a></li>
                                <li><a href="../classes/platypus.components.RelayLinker.html">platypus.components.RelayLinker</a></li>
                                <li><a href="../classes/platypus.components.RelayParent.html">platypus.components.RelayParent</a></li>
                                <li><a href="../classes/platypus.components.RelaySelf.html">platypus.components.RelaySelf</a></li>
                                <li><a href="../classes/platypus.components.RenderAnimation.html">platypus.components.RenderAnimation</a></li>
                                <li><a href="../classes/platypus.components.RenderContainer.html">platypus.components.RenderContainer</a></li>
                                <li><a href="../classes/platypus.components.RenderDebug.html">platypus.components.RenderDebug</a></li>
                                <li><a href="../classes/platypus.components.RenderDestroyMe.html">platypus.components.RenderDestroyMe</a></li>
                                <li><a href="../classes/platypus.components.RenderProgress.html">platypus.components.RenderProgress</a></li>
                                <li><a href="../classes/platypus.components.RenderSpine.html">platypus.components.RenderSpine</a></li>
                                <li><a href="../classes/platypus.components.RenderSprite.html">platypus.components.RenderSprite</a></li>
                                <li><a href="../classes/platypus.components.RenderText.html">platypus.components.RenderText</a></li>
                                <li><a href="../classes/platypus.components.RenderTiles.html">platypus.components.RenderTiles</a></li>
                                <li><a href="../classes/platypus.components.SceneChanger.html">platypus.components.SceneChanger</a></li>
                                <li><a href="../classes/platypus.components.StateRender.html">platypus.components.StateRender</a></li>
                                <li><a href="../classes/platypus.components.TiledLoader.html">platypus.components.TiledLoader</a></li>
                                <li><a href="../classes/platypus.components.Timeline.html">platypus.components.Timeline</a></li>
                                <li><a href="../classes/platypus.components.Tutorial.html">platypus.components.Tutorial</a></li>
                                <li><a href="../classes/platypus.components.VoiceOver.html">platypus.components.VoiceOver</a></li>
                                <li><a href="../classes/platypus.components.XHR.html">platypus.components.XHR</a></li>
                                <li><a href="../classes/platypus.Data.html">platypus.Data</a></li>
                                <li><a href="../classes/platypus.DataMap.html">platypus.DataMap</a></li>
                                <li><a href="../classes/platypus.Entity.html">platypus.Entity</a></li>
                                <li><a href="../classes/platypus.Game.html">platypus.Game</a></li>
                                <li><a href="../classes/platypus.Messenger.html">platypus.Messenger</a></li>
                                <li><a href="../classes/platypus.PIXIAnimation.html">platypus.PIXIAnimation</a></li>
                                <li><a href="../classes/platypus.PlatypusPlugin.html">platypus.PlatypusPlugin</a></li>
                                <li><a href="../classes/platypus.Scene.html">platypus.Scene</a></li>
                                <li><a href="../classes/platypus.StateMap.html">platypus.StateMap</a></li>
                                <li><a href="../classes/platypus.Vector.html">platypus.Vector</a></li>
                                <li><a href="../classes/window.Array.html">window.Array</a></li>
                                <li><a href="../classes/window.Map.html">window.Map</a></li>
                                <li><a href="../classes/window.String.html">window.String</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/platypus.html">platypus</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
            <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <script>
                        	var name = src\components\StateRender.js      
                        </script>
                        <h1 class="file-heading">File:src\components\StateRender.js</h1>
                        
                        <div class="file">
                            <pre class="code prettyprint linenums">
                        /**
                         * This component is typically added to an entity automatically by a render component. It handles mapping entity states to playable animations.
                         *
                         * @class StateRender
                         * @uses platypus.Component
                         * @since 0.9.0
                         */
                        /*global include, platypus */
                        (function () {
                            &#x27;use strict&#x27;;
                            
                            var StateMap = include(&#x27;platypus.StateMap&#x27;),
                                createTest = function (testStates, animation) {
                                    if (testStates === &#x27;default&#x27;) {
                                        return defaultTest.bind(null, animation);
                                    } else {
                                        //TODO: Better clean-up: Create a lot of these without removing them later... DDD 2/5/2016
                                        return stateTest.bind(null, animation, StateMap.setUp(testStates));
                                    }
                                },
                                defaultTest = function (animation) {
                                    return animation;
                                },
                                methodPlay = function (animation, restart) {
                                    this.component.playAnimation(animation, restart);
                                },
                                methodStop = function (animation) {
                                    this.component.stopAnimation(animation);
                                },
                                stateTest = function (animation, states, ownerState) {
                                    if (ownerState.includes(states)) {
                                        return animation;
                                    }
                                    return false;
                                },
                                triggerPlay = function (animation, restart) {
                                    /**
                                     * On entering a new animation-mapped state, this component triggers this event to play an animation.
                                     *
                                     * @event &#x27;play-animation&#x27;
                                     * @param animation {String} Describes the animation to play.
                                     * @param restart {Boolean} Whether to restart a playing animation.
                                     */
                                    this.owner.triggerEvent(&#x27;play-animation&#x27;, animation, restart);
                                },
                                triggerStop = function (animation) {
                                    /**
                                     * On attaining an animation-mapped state, this component triggers this event to stop a previous animation.
                                     *
                                     * @event &#x27;stop-animation&#x27;
                                     * @param animation {String} Describes the animation to stop.
                                     */
                                    this.owner.triggerEvent(&#x27;stop-animation&#x27;, animation);
                                };
                        
                            return platypus.createComponentClass({
                                id: &#x27;StateRender&#x27;,
                        
                                properties: {
                                    /**
                                     * An object containg key-value pairs that define a mapping from entity states to the animation that should play. The list is processed from top to bottom, so the most important actions should be listed first (for example, a jumping animation might take precedence over an idle animation). If not specified, an 1-to-1 animation map is created from the list of animations in the sprite sheet definition using the animation names as the keys.
                                     *
                                     *  &quot;animationMap&quot;:{
                                     *      &quot;standing&quot;: &quot;default-animation&quot;  // On receiving a &quot;standing&quot; event, or when this.owner.state.standing === true, the &quot;default&quot; animation will begin playing.
                                     *      &quot;ground,moving&quot;: &quot;walking&quot;,  // Comma separated values have a special meaning when evaluating &quot;state-changed&quot; messages. The above example will cause the &quot;walking&quot; animation to play ONLY if the entity&#x27;s state includes both &quot;moving&quot; and &quot;ground&quot; equal to true.
                                     *      &quot;ground,striking&quot;: &quot;swing!&quot;, // Putting an exclamation after an animation name causes this animation to complete before going to the next animation. This is useful for animations that would look poorly if interrupted.
                                     *      &quot;default&quot;: &quot;default-animation&quot; // Optional. &quot;default&quot; is a special property that matches all states. If none of the above states are valid for the entity, it will use the default animation listed here.
                                     *  }
                                     *
                                     * @property animationMap
                                     * @type Object
                                     * @default null
                                     */
                                    &quot;animationMap&quot;: null,
                        
                                    /**
                                     * Sets a component that this component should be connected to.
                                     *
                                     * @property component
                                     * @type Component
                                     * @default null
                                     * @since 0.9.2
                                     */
                                    component: null,
                        
                                    /**
                                     * Optional. Forces animations to complete before starting a new animation. Defaults to &#x60;false&#x60;.
                                     *
                                     * @property forcePlayThrough
                                     * @type Boolean
                                     * @default false
                                     */
                                    forcePlayThrough: false
                                },
                        
                                initialize: function () {
                                    var anim      = &#x27;&#x27;,
                                        animation = &#x27;&#x27;,
                                        map = this.animationMap;
                        
                                    this.followThroughs = {};
                                    this.checkStates = Array.setUp();
                                    this.state = this.owner.state;
                                    this.stateChange = true; //Check state against entity&#x27;s prior state to update animation if necessary on instantiation.
                                    this.lastState = -1;
                        
                                    for (anim in map) {
                                        if (map.hasOwnProperty(anim)) {
                                            animation = map[anim];
                        
                                            //TODO: Should probably find a cleaner way to accomplish this. Maybe in the animationMap definition? - DDD
                                            if (animation[animation.length - 1] === &#x27;!&#x27;) {
                                                animation = animation.substring(0, animation.length - 1);
                                                this.followThroughs[animation] = true;
                                            } else {
                                                this.followThroughs[animation] = false;
                                            }
                        
                                            this.checkStates.push(createTest(anim, animation));
                                        }
                                    }
                        
                                    this.waitingAnimation = false;
                                    this.waitingState = 0;
                                    this.playWaiting = false;
                                    this.animationFinished = false;
                        
                                    if (this.component) {
                                        this.playAnimation = methodPlay;
                                        this.stopAnimation = methodStop;
                                    } else {
                                        this.playAnimation = triggerPlay;
                                        this.stopAnimation = triggerStop;
                                    }
                                },
                        
                                events: {
                                    /**
                                     * This listens for the entity state to change and will update the currently playing animation.
                                     *
                                     * @method &#x27;state-changed&#x27;
                                     */
                                    &quot;state-changed&quot;: function () {
                                        this.stateChange = true;
                                    },
                        
                                    /**
                                     * On receiving this event, the component checks for any waiting animations and begins playing them if so.
                                     *
                                     * @method &#x27;animation-ended&#x27;
                                     * @param animation {String} The animation that completed.
                                     */
                                    &quot;animation-ended&quot;: function (animation) {
                                        if (animation === this.currentAnimation) {
                                            if (this.waitingAnimation) {
                                                this.currentAnimation = this.waitingAnimation;
                                                this.waitingAnimation = false;
                                                this.lastState = this.waitingState;
                                                
                                                this.animationFinished = false;
                                                this.playAnimation(this.currentAnimation);
                                            } else {
                                                this.animationFinished = true;
                                            }
                                        }
                                    },
                        
                                    /**
                                     * This checks to determine whether another animation should begin playing.
                                     *
                                     * @method update-animation
                                     * @param playing {Boolean} Whether the new animation should play or pause on the first frame.
                                     */
                                    &quot;update-animation&quot;: function (playing) {
                                        var i = 0,
                                            testCase = false;
                        
                                        if (this.stateChange) {
                                            if (this.state.has(&#x27;visible&#x27;)) {
                                                this.visible = this.state.get(&#x27;visible&#x27;);
                                            }
                                            if (this.checkStates) {
                                                for (i = 0; i &lt; this.checkStates.length; i++) {
                                                    testCase = this.checkStates[i](this.state);
                                                    if (testCase) {
                                                        if (this.currentAnimation !== testCase) {
                                                            if (!this.followThroughs[this.currentAnimation] &amp;&amp; (!this.forcePlaythrough || (this.animationFinished || (this.lastState &gt;= +i)))) {
                                                                this.currentAnimation = testCase;
                                                                this.lastState = +i;
                                                                this.animationFinished = false;
                                                                if (playing) {
                                                                    this.playAnimation(this.currentAnimation);
                                                                } else {
                                                                    this.stopAnimation(this.currentAnimation);
                                                                }
                                                            } else {
                                                                this.waitingAnimation = testCase;
                                                                this.waitingState = +i;
                                                            }
                                                        } else if (this.waitingAnimation &amp;&amp; !this.followThroughs[this.currentAnimation]) {// keep animating this animation since this animation has already overlapped the waiting animation.
                                                            this.waitingAnimation = false;
                                                        }
                                                        break;
                                                    }
                                                }
                                            }
                                            this.stateChange = false;
                                        }
                                    }
                                },
                                
                                methods: {
                                    toJSON: function () { // This component is added by another component, so it shouldn&#x27;t be returned for reconstruction.
                                        return null;
                                    },
                        
                                    destroy: function () {
                                        this.checkStates.recycle();
                                        this.followThroughs = null;
                                        this.state = null;
                                    }
                                },
                                
                                publicMethods: {
                                }
                            });
                        }());
                        
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
